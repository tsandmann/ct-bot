language: cpp
dist: trusty
sudo: true
osx_image: xcode9.2

os:
  - linux
  - osx

env:
  - MINGW=false
  - MINGW=true

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "true" ]]; then sudo apt-get -qq update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "true" ]]; then sudo apt-get install -y mingw-w64; fi

script:
  - if [[ "$MINGW" == "false" ]]; then ./tests/run_tests_pc.sh; fi
  - if [[ "$MINGW" == "false" ]]; then ./tests/run_tests_mcu.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "false" ]]; then ./tests/run_tests_rpi3-armhf.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" && "$MINGW" == "false" ]]; then ./tests/run_tests_rpi3-armhf.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "true" ]]; then ./tests/run_tests_mingw.sh; fi

after_success:
  - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"
