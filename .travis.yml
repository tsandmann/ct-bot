dist: bionic
osx_image: xcode11
sudo: true

language: cpp

cache:
  directories:
    - "~/.platformio"

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -qq update; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -y install python3-pip; fi

install:
  - pip3 install -U platformio
  - platformio update

os:
  - linux
  - osx

env:
  - MINGW=false
  - MINGW=true

before_script:
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "true" ]]; then sudo apt-get install -y mingw-w64; fi

script:
  - if [[ "$MINGW" == "false" ]]; then ./tests/run_tests_pc.sh; fi
  - if [[ "$MINGW" == "false" ]]; then ./tests/run_tests_mcu.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "false" ]]; then ./tests/run_tests_rpi3-armhf.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" && "$MINGW" == "false" ]]; then ./tests/run_tests_rpi3-armhf.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" && "$MINGW" == "true" ]]; then BUILD_TARGET=x86_64-w64-mingw32 ./tests/run_tests_pc.sh; fi
